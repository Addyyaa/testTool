# 拖拽下载功能使用指南

## 功能概述

文件传输工具新增了拖拽下载功能，允许用户直接从远程目录列表中拖拽文件到本地计算机的任意位置进行下载。这个功能基于模块化设计，提供了直观的用户体验。

## 功能特性

### 🎯 核心功能
- **直观操作**: 直接拖拽文件到本地文件夹
- **智能检测**: 自动检测拖拽到窗口外部的操作
- **文件夹选择**: 自动弹出文件夹选择对话框
- **进度反馈**: 实时显示下载进度
- **错误处理**: 完善的错误提示和异常恢复

### 🔧 技术特性
- **模块化设计**: 独立的拖拽处理组件
- **异步下载**: 后台下载不阻塞界面
- **文件重命名**: 自动处理重名文件
- **资源管理**: 自动清理临时文件
- **状态管理**: 完整的下载状态跟踪

## 使用方法

### 1. 连接到远程设备
首先需要连接到远程设备，拖拽下载功能会在连接成功后自动启用。

### 2. 浏览文件目录
在左侧目录面板中浏览远程设备的文件系统，找到需要下载的文件。

### 3. 拖拽下载文件
1. **选择文件**: 在目录树中点击选中要下载的文件
2. **开始拖拽**: 按住鼠标左键并拖拽文件图标
3. **拖拽到外部**: 将文件拖拽到程序窗口外部（如桌面、文件夹等）
4. **选择目标**: 系统会自动弹出文件夹选择对话框
5. **确认下载**: 选择目标文件夹后，下载会自动开始

### 4. 监控下载进度
- 状态栏会显示当前下载进度
- 下载完成后会显示成功提示
- 如果出现错误，会显示详细的错误信息

## 界面指引

### 拖拽状态提示
- **准备拖拽**: 鼠标指针变为手型
- **拖拽中**: 鼠标指针保持手型状态
- **拖拽完成**: 鼠标指针恢复正常

### 状态栏信息
- `开始下载: 文件名` - 下载开始
- `下载中: 文件名 (进度%)` - 下载进行中
- `下载完成: 文件名` - 下载成功
- `下载失败: 文件名` - 下载失败

## 注意事项

### ⚠️ 使用限制
- **仅支持文件**: 目录不支持拖拽下载
- **需要连接**: 必须先连接到远程设备
- **文件权限**: 需要有读取文件的权限

### 💡 使用技巧
- **重名处理**: 如果目标文件夹中已存在同名文件，系统会自动重命名（如 `file_1.txt`）
- **取消下载**: 可以通过断开连接来取消正在进行的下载
- **批量下载**: 目前暂不支持多文件同时拖拽，请逐个下载

### 🔧 故障排除

#### 拖拽无响应
- 确认已连接到远程设备
- 确认选中的是文件而非目录
- 检查网络连接是否正常

#### 下载失败
- 检查远程文件是否存在
- 确认有足够的本地磁盘空间
- 检查目标文件夹的写入权限

#### 进度显示异常
- 这通常是网络延迟导致的，请耐心等待
- 如果长时间无响应，可以断开重连

## 技术架构

### 模块组成
1. **DragDownloadManager**: 拖拽下载管理器
   - 负责下载任务的创建和管理
   - 提供进度回调和状态跟踪
   - 处理文件下载和错误恢复

2. **DragHandler**: 拖拽处理器
   - 处理鼠标拖拽事件
   - 检测拖拽到窗口外部
   - 触发文件夹选择对话框

3. **DirectoryPanel**: 目录面板
   - 集成拖拽处理器
   - 提供拖拽下载回调接口
   - 管理拖拽功能的启用/禁用

### 工作流程
1. 用户在目录树中拖拽文件
2. 拖拽处理器检测到外部拖拽
3. 弹出文件夹选择对话框
4. 用户选择目标文件夹
5. 创建下载任务并开始下载
6. 通过HTTP服务器下载文件
7. 保存到本地并清理临时文件

## 日志配置

拖拽下载功能的日志记录遵循统一的日志配置系统。可以在 `fileTransfer/log_config.py` 中调整相关模块的日志等级：

```python
# 拖拽下载相关模块的日志等级
MODULE_LOG_LEVELS = {
    'DragDownloadManager': logging.INFO,
    'DragHandler': logging.DEBUG,
    'DirectoryPanel': logging.DEBUG,
}
```

## 更新历史

### v1.0.0 (当前版本)
- ✅ 基础拖拽下载功能
- ✅ 文件夹选择对话框
- ✅ 进度反馈和状态显示
- ✅ 错误处理和异常恢复
- ✅ 模块化架构设计
- ✅ 统一日志配置集成

### 计划功能
- 🔄 多文件批量拖拽下载
- 🔄 拖拽到指定文件夹（无需对话框）
- 🔄 下载进度条可视化
- 🔄 下载历史记录
- 🔄 断点续传支持

## 反馈与支持

如果在使用过程中遇到问题或有改进建议，请通过以下方式反馈：
- 查看日志文件获取详细错误信息
- 检查网络连接和权限设置
- 尝试重新连接设备后再次操作

---

*此功能按照模块化设计原则开发，确保代码的可维护性和可扩展性。* 